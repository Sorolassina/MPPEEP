# TÃ¢ches planifiÃ©es
# Health checks, backups, rapports

name: TÃ¢ches PlanifiÃ©es

on:
  schedule:
    # Tous les jours Ã  2h du matin (UTC)
    - cron: '0 2 * * *'
  workflow_dispatch:  # Manuel

jobs:
  health-check:
    name: Health Check Quotidien
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ¥ Health Check Production
      run: |
        response=$(curl -s https://mondomaine.com/api/v1/ping)
        
        if echo "$response" | grep -q "pong"; then
          echo "âœ… Application en ligne"
        else
          echo "âŒ Application hors ligne"
          exit 1
        fi
    
    - name: ğŸš¨ Alerte si DOWN
      if: failure()
      uses: 8398a7/action-slack@v3
      with:
        status: 'failure'
        text: 'ğŸš¨ ALERTE : Application DOWN !'
        webhook_url: ${{ secrets.SLACK_WEBHOOK }}

  dependency-check:
    name: VÃ©rification DÃ©pendances
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
    
    - name: ğŸ Configuration Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.11"
    
    - name: ğŸ” VÃ©rifier les vulnÃ©rabilitÃ©s
      run: |
        pip install safety
        cd mppeep
        safety check --json || true
    
    - name: ğŸ“Š Rapport mensuel
      run: |
        echo "ğŸ“Š Rapport de dÃ©pendances - $(date)"
        pip list --outdated

  backup-notification:
    name: VÃ©rification Backups
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¢ Rappel Backup
      run: |
        echo "ğŸ’¾ VÃ©rifier que les backups automatiques fonctionnent"
        echo "   Derniers backups attendus dans C:\Backups\mppeep\"


# üìò Parcours d'une Requ√™te Client - De la Demande √† la R√©ponse

## üéØ Vue d'ensemble

Ce document d√©taille le **parcours complet d'une requ√™te HTTP** depuis le navigateur du client jusqu'√† la r√©ponse renvoy√©e par le serveur, en passant par tous les composants de l'architecture MPPEEP.

---

## üìã EXEMPLE CONCRET

Nous allons suivre le parcours de cette requ√™te :

**Action utilisateur** : L'utilisateur clique sur "Nouvelle Demande RH" apr√®s s'√™tre connect√©.

**Requ√™te HTTP** :
```http
GET /api/v1/rh/demandes/new HTTP/1.1
Host: localhost:9000
Cookie: access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
User-Agent: Mozilla/5.0...
Accept: text/html,application/xhtml+xml...
```

---

## üîÑ PHASE 1 : R√âCEPTION DE LA REQU√äTE

### √âtape 1.1 : Uvicorn re√ßoit la connexion TCP

```
Navigateur (Chrome)  ‚Üí  TCP/IP  ‚Üí  Uvicorn (Port 9000)
```

**Ce qui se passe** :
1. Le navigateur √©tablit une connexion TCP sur `localhost:9000`
2. Uvicorn accepte la connexion
3. Uvicorn lit les octets de la requ√™te HTTP
4. Uvicorn parse les headers, la m√©thode, le chemin, etc.

**Log** :
```
üì• GET /api/v1/rh/demandes/new | Request-ID: xY7k9mN2
```

### √âtape 1.2 : Cr√©ation de l'objet Request

Uvicorn cr√©e un objet `Request` FastAPI :

```python
request = Request(
    scope={
        "type": "http",
        "method": "GET",
        "path": "/api/v1/rh/demandes/new",
        "query_string": b"",
        "headers": [
            (b"host", b"localhost:9000"),
            (b"cookie", b"access_token=eyJ..."),
            (b"user-agent", b"Mozilla/5.0..."),
            ...
        ],
        "server": ("127.0.0.1", 9000),
        "client": ("127.0.0.1", 54321),
    }
)
```

---

## üõ°Ô∏è PHASE 2 : MIDDLEWARES (Traitement pr√©-route)

### Middleware 1 : Logging

**Fichier** : `app/main.py`

```python
@app.middleware("http")
async def log_requests(request: Request, call_next):
    start_time = time.time()
    request_id = secrets.token_urlsafe(8)
    
    # Log de la requ√™te entrante
    logger.info(f"üì• {request.method} {request.url.path} | Request-ID: {request_id}")
    
    # Passer au middleware suivant (ou √† la route)
    response = await call_next(request)
    
    # Log de la r√©ponse sortante
    duration = time.time() - start_time
    logger.info(
        f"üì§ {request.method} {request.url.path} | "
        f"Status: {response.status_code} | "
        f"Duration: {duration:.3f}s | "
        f"Request-ID: {request_id}"
    )
    
    return response
```

**R√©sultat** : Request-ID g√©n√©r√© = `xY7k9mN2`

### Middleware 2 : CORS (si activ√©)

```python
# V√©rifie les headers Origin, Access-Control-Allow-*
# Ajoute les headers CORS √† la r√©ponse
```

---

## üó∫Ô∏è PHASE 3 : ROUTAGE

### √âtape 3.1 : FastAPI cherche la route correspondante

FastAPI parcourt les routes enregistr√©es :

```python
routes = [
    Route("/", root),
    Route("/api/v1/auth/login", login_page),
    Route("/api/v1/auth/logout", logout),
    Route("/api/v1/", accueil),
    Route("/api/v1/rh/", rh_home),
    Route("/api/v1/rh/demandes/new", rh_new_demande),  # ‚úÖ MATCH !
    ...
]
```

**Match trouv√©** : `rh_new_demande` dans `app/api/v1/endpoints/rh.py`

### √âtape 3.2 : Extraction des d√©pendances

**Signature de la fonction** :

```python
@router.get("/demandes/new", response_class=HTMLResponse, name="rh_new_demande")
def rh_new_demande(
    request: Request,
    session: Session = Depends(get_session),
    current_user: User = Depends(get_current_user)
):
```

**D√©pendances √† r√©soudre** :
1. `request` ‚Üí Fourni automatiquement par FastAPI
2. `session` ‚Üí D√©pend de `get_session()`
3. `current_user` ‚Üí D√©pend de `get_current_user()`

---

## üîê PHASE 4 : R√âSOLUTION DES D√âPENDANCES

### D√©pendance 1 : `get_session()`

**Fichier** : `app/db/session.py`

```python
def get_session() -> Session:
    """Cr√©e une session de base de donn√©es"""
    with Session(engine) as session:
        yield session
```

**R√©sultat** : Cr√©ation d'une session SQLite connect√©e √† `mppeep.db`

### D√©pendance 2 : `get_current_user()`

**Fichier** : `app/api/v1/endpoints/auth.py`

```python
def get_current_user(
    request: Request,
    session: Session = Depends(get_session)
) -> User:
    """R√©cup√®re l'utilisateur connect√© depuis le token JWT"""
    
    # 1. R√©cup√©rer le cookie
    token = request.cookies.get("access_token")
    if not token:
        raise HTTPException(
            status_code=401,
            detail="Non authentifi√©"
        )
    
    # 2. D√©coder le token JWT
    try:
        payload = jwt.decode(
            token,
            SECRET_KEY,
            algorithms=[ALGORITHM]
        )
        user_id: int = payload.get("sub")
    except JWTError:
        raise HTTPException(
            status_code=401,
            detail="Token invalide"
        )
    
    # 3. R√©cup√©rer l'utilisateur en base
    user = session.get(User, user_id)
    if not user or not user.is_active:
        raise HTTPException(
            status_code=401,
            detail="Utilisateur introuvable ou inactif"
        )
    
    return user
```

**√âtapes d√©taill√©es** :

1. **Extraction du cookie** :
```python
token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwiZXhwIjoxNzM1MDg5NjAwfQ..."
```

2. **D√©codage JWT** :
```python
payload = {
    "sub": "1",  # ID de l'utilisateur
    "exp": 1735089600  # Date d'expiration (timestamp)
}
```

3. **Requ√™te SQL** :
```sql
SELECT * FROM user WHERE id = 1;
```

4. **R√©sultat** :
```python
user = User(
    id=1,
    email="admin@mppeep.gov",
    full_name="Administrateur",
    role=UserRole.ADMIN,
    is_active=True,
    agent_id=1
)
```

**Si erreur** : `HTTPException(401)` lev√©e ‚Üí Fin du traitement, r√©ponse 401 envoy√©e

---

## üéØ PHASE 5 : EX√âCUTION DE LA ROUTE

### Fonction : `rh_new_demande()`

**Fichier** : `app/api/v1/endpoints/rh.py`

```python
@router.get("/demandes/new", response_class=HTMLResponse, name="rh_new_demande")
def rh_new_demande(
    request: Request,
    session: Session = Depends(get_session),
    current_user: User = Depends(get_current_user)
):
    """Page de cr√©ation d'une nouvelle demande RH"""
    
    # 1. R√©cup√©rer les types de demandes personnalis√©s
    request_types = session.exec(
        select(RequestTypeCustom)
        .where(RequestTypeCustom.actif == True)
        .order_by(RequestTypeCustom.ordre)
    ).all()
    
    # 2. Grouper par cat√©gorie
    types_by_category = {}
    for rt in request_types:
        category = rt.categorie or "Autres"
        if category not in types_by_category:
            types_by_category[category] = []
        types_by_category[category].append(rt)
    
    # 3. R√©cup√©rer l'agent li√© √† l'utilisateur
    agent = None
    if current_user.agent_id:
        agent = session.get(AgentComplet, current_user.agent_id)
    
    # 4. Retourner le template avec les donn√©es
    return templates.TemplateResponse(
        "pages/rh_demande_new.html",
        get_template_context(
            request,
            current_user=current_user,
            request_types_custom=request_types,
            types_by_category=types_by_category,
            agent=agent
        )
    )
```

### √âtape 5.1 : Requ√™tes SQL ex√©cut√©es

**Requ√™te 1 : Types de demandes**
```sql
SELECT * 
FROM request_type_custom 
WHERE actif = 1 
ORDER BY ordre;
```

**R√©sultat** :
```python
[
    RequestTypeCustom(id=1, code="CONGE", libelle="Demande de Cong√©", categorie="Cong√©s"),
    RequestTypeCustom(id=2, code="MISSION", libelle="Ordre de Mission", categorie="Missions"),
    RequestTypeCustom(id=3, code="FORMATION", libelle="Demande de Formation", categorie="Formation"),
]
```

**Requ√™te 2 : Agent de l'utilisateur**
```sql
SELECT * 
FROM agent_complet 
WHERE id = 1;
```

**R√©sultat** :
```python
agent = AgentComplet(
    id=1,
    matricule="2025-001",
    nom="DUPONT",
    prenom="Jean",
    grade_id=5,
    service_id=3,
    fonction="Chef de Service"
)
```

### √âtape 5.2 : Pr√©paration du contexte template

```python
context = {
    "request": request,
    "app_name": "MPPEEP Dashboard",
    "current_user": User(id=1, email="admin@mppeep.gov", ...),
    "current_year": 2025,
    "request_types_custom": [...],
    "types_by_category": {
        "Cong√©s": [...],
        "Missions": [...],
        "Formation": [...]
    },
    "agent": AgentComplet(id=1, matricule="2025-001", ...)
}
```

---

## üé® PHASE 6 : RENDU DU TEMPLATE JINJA2

### √âtape 6.1 : Chargement du template

**Fichier** : `app/templates/pages/rh_demande_new.html`

```html
{% extends "layouts/base.html" %}
{% from 'components/page_header.html' import page_header %}

{% block title %}Nouvelle Demande - {{ app_name }}{% endblock %}

{% block content %}
{{ page_header(
    title='‚ûï Nouvelle Demande RH',
    breadcrumbs=[
        {'name': 'Accueil', 'url': url_for('accueil')},
        {'name': 'RH', 'url': url_for('rh_home')},
        {'name': 'Nouvelle Demande'}
    ]
) }}

<form id="demandeForm" onsubmit="submitDemande(event)">
    <!-- Agent demandeur (pr√©-rempli) -->
    <div class="form-group">
        <label>Agent demandeur</label>
        <input type="hidden" name="agent_id" value="{{ agent.id if agent else '' }}" readonly>
        <input type="text" class="form-input" readonly
               value="{{ agent.matricule }} - {{ agent.nom }} {{ agent.prenom }}" >
    </div>
    
    <!-- Type de demande -->
    <div class="form-group">
        <label>Type de demande *</label>
        <select name="type" class="form-select" required>
            <option value="">-- S√©lectionner --</option>
            {% for category, types in types_by_category.items() %}
                <optgroup label="{{ category }}">
                    {% for rt in types %}
                        <option value="{{ rt.code }}">{{ rt.libelle }}</option>
                    {% endfor %}
                </optgroup>
            {% endfor %}
        </select>
    </div>
    
    <!-- Autres champs... -->
    
    <button type="submit" class="btn btn-primary">Cr√©er la Demande</button>
</form>
{% endblock %}
```

### √âtape 6.2 : Compilation Jinja2

Jinja2 remplace les variables et ex√©cute la logique :

**Avant** :
```html
<input type="text" value="{{ agent.matricule }} - {{ agent.nom }} {{ agent.prenom }}">
```

**Apr√®s** :
```html
<input type="text" value="2025-001 - DUPONT Jean">
```

**Avant** :
```html
{% for category, types in types_by_category.items() %}
    <optgroup label="{{ category }}">
        {% for rt in types %}
            <option value="{{ rt.code }}">{{ rt.libelle }}</option>
        {% endfor %}
    </optgroup>
{% endfor %}
```

**Apr√®s** :
```html
<optgroup label="Cong√©s">
    <option value="CONGE">Demande de Cong√©</option>
</optgroup>
<optgroup label="Missions">
    <option value="MISSION">Ordre de Mission</option>
</optgroup>
<optgroup label="Formation">
    <option value="FORMATION">Demande de Formation</option>
</optgroup>
```

### √âtape 6.3 : Application du layout de base

**Fichier** : `app/templates/layouts/base.html`

```html
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ app_name }}{% endblock %}</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/forms.css">
    <link rel="stylesheet" href="/static/css/cards.css">
    
    {% block styles %}{% endblock %}
</head>
<body>
    <!-- Navigation -->
    {% if current_user %}
        {% include 'components/navbar.html' %}
    {% endif %}
    
    <!-- Contenu principal -->
    <main class="container">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Footer -->
    <footer>
        <p>&copy; {{ current_year }} {{ app_name }} - Tous droits r√©serv√©s</p>
    </footer>
    
    <!-- JavaScript -->
    <script src="/static/js/app.js"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
```

### √âtape 6.4 : HTML final g√©n√©r√©

```html
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Nouvelle Demande - MPPEEP Dashboard</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/forms.css">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">MPPEEP Dashboard</div>
        <div class="navbar-menu">
            <a href="/api/v1/">Accueil</a>
            <a href="/api/v1/rh/">RH</a>
            <a href="/api/v1/personnel/">Personnel</a>
            <span>üë§ admin@mppeep.gov</span>
        </div>
    </nav>
    
    <main class="container">
        <div class="page-header">
            <h1>‚ûï Nouvelle Demande RH</h1>
            <nav class="breadcrumb">
                <a href="/api/v1/">Accueil</a> / 
                <a href="/api/v1/rh/">RH</a> / 
                <span>Nouvelle Demande</span>
            </nav>
        </div>
        
        <form id="demandeForm">
            <div class="form-group">
                <label>Agent demandeur</label>
                <input type="hidden" name="agent_id" value="1">
                <input type="text" value="2025-001 - DUPONT Jean" readonly>
            </div>
            
            <div class="form-group">
                <label>Type de demande *</label>
                <select name="type" required>
                    <option value="">-- S√©lectionner --</option>
                    <optgroup label="Cong√©s">
                        <option value="CONGE">Demande de Cong√©</option>
                    </optgroup>
                    <optgroup label="Missions">
                        <option value="MISSION">Ordre de Mission</option>
                    </optgroup>
                </select>
            </div>
            
            <button type="submit">Cr√©er la Demande</button>
        </form>
    </main>
    
    <footer>
        <p>&copy; 2025 MPPEEP Dashboard - Tous droits r√©serv√©s</p>
    </footer>
    
    <script src="/static/js/app.js"></script>
</body>
</html>
```

**Taille du HTML** : ~15 Ko

---

## üì§ PHASE 7 : CONSTRUCTION DE LA R√âPONSE HTTP

### √âtape 7.1 : Cr√©ation de l'objet Response

```python
response = HTMLResponse(
    content=html_final,  # Le HTML compil√©
    status_code=200,
    headers={
        "content-type": "text/html; charset=utf-8",
        "content-length": "15234",
    }
)
```

### √âtape 7.2 : Retour au middleware de logging

Le middleware calcule la dur√©e :

```python
duration = time.time() - start_time  # 0.125 secondes
logger.info(f"üì§ GET /api/v1/rh/demandes/new | Status: 200 | Duration: 0.125s")
```

---

## üåê PHASE 8 : ENVOI DE LA R√âPONSE

### √âtape 8.1 : S√©rialisation HTTP

Uvicorn convertit l'objet Response en octets HTTP :

```http
HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 15234
Set-Cookie: session_id=abc123; Path=/; HttpOnly
Date: Sun, 19 Oct 2025 01:15:30 GMT
Server: uvicorn

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Nouvelle Demande - MPPEEP Dashboard</title>
    ...
</body>
</html>
```

### √âtape 8.2 : Envoi sur le socket TCP

```
Uvicorn ‚Üí TCP/IP ‚Üí Navigateur (Chrome)
```

**Octets envoy√©s** : ~15 Ko de HTML

---

## üñ•Ô∏è PHASE 9 : RENDU DANS LE NAVIGATEUR

### √âtape 9.1 : Parsing HTML

Le navigateur parse le HTML et construit le DOM (Document Object Model) :

```
DOM Tree:
‚îú‚îÄ‚îÄ html
    ‚îú‚îÄ‚îÄ head
    ‚îÇ   ‚îú‚îÄ‚îÄ meta (charset)
    ‚îÇ   ‚îú‚îÄ‚îÄ title
    ‚îÇ   ‚îú‚îÄ‚îÄ link (style.css)
    ‚îÇ   ‚îî‚îÄ‚îÄ link (forms.css)
    ‚îî‚îÄ‚îÄ body
        ‚îú‚îÄ‚îÄ nav (navbar)
        ‚îú‚îÄ‚îÄ main (container)
        ‚îÇ   ‚îú‚îÄ‚îÄ div (page-header)
        ‚îÇ   ‚îî‚îÄ‚îÄ form (demandeForm)
        ‚îî‚îÄ‚îÄ footer
```

### √âtape 9.2 : Chargement des ressources

Le navigateur d√©tecte les ressources √† charger :

**Requ√™te 2** :
```http
GET /static/css/style.css HTTP/1.1
```

**Requ√™te 3** :
```http
GET /static/css/forms.css HTTP/1.1
```

**Requ√™te 4** :
```http
GET /static/js/app.js HTTP/1.1
```

Chaque requ√™te passe par les m√™mes phases 1-8 (mais sans authentification pour les fichiers statiques).

### √âtape 9.3 : Application des styles CSS

Le navigateur applique les r√®gles CSS :

```css
.form-group {
    margin-bottom: 1.5rem;
}

.form-input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ccc;
    border-radius: 4px;
}

.btn-primary {
    background-color: #007bff;
    color: white;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}
```

**CSSOM (CSS Object Model)** construit.

### √âtape 9.4 : Calcul du layout (Render Tree)

Le navigateur calcule la position et la taille de chaque √©l√©ment :

```
Render Tree:
‚îú‚îÄ‚îÄ Body (1920x1080px)
    ‚îú‚îÄ‚îÄ Navbar (1920x60px, top:0)
    ‚îú‚îÄ‚îÄ Main Container (1200x800px, centered)
    ‚îÇ   ‚îú‚îÄ‚îÄ Page Header (1200x80px)
    ‚îÇ   ‚îî‚îÄ‚îÄ Form (1200x500px)
    ‚îÇ       ‚îú‚îÄ‚îÄ Form Group 1 (1200x80px)
    ‚îÇ       ‚îú‚îÄ‚îÄ Form Group 2 (1200x80px)
    ‚îÇ       ‚îî‚îÄ‚îÄ Button (150x40px)
    ‚îî‚îÄ‚îÄ Footer (1920x60px, bottom:0)
```

### √âtape 9.5 : Peinture (Painting)

Le navigateur dessine les pixels √† l'√©cran :

1. **Arri√®re-plan** : Couleur de fond blanche
2. **Navbar** : Fond bleu, texte blanc
3. **Formulaire** : Champs de saisie, bordures grises
4. **Bouton** : Fond bleu, texte blanc, ombre port√©e
5. **Footer** : Texte gris centr√©

### √âtape 9.6 : Ex√©cution JavaScript

Le navigateur ex√©cute `app.js` :

```javascript
// Gestion globale des erreurs
function handleFetchError(response, result) {
    if (result && result.detail) {
        alert(result.detail);
    }
}

// Fonction de soumission du formulaire
async function submitDemande(event) {
    event.preventDefault();
    
    const formData = new FormData(event.target);
    
    try {
        const response = await fetch("/api/v1/rh/api/demandes", {
            method: "POST",
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert("Demande cr√©√©e avec succ√®s !");
            window.location.href = "/api/v1/rh/";
        } else {
            handleFetchError(response, result);
        }
    } catch (error) {
        alert("Erreur r√©seau");
    }
}
```

**Event Listener** attach√© au formulaire.

---

## ‚è±Ô∏è PHASE 10 : PAGE AFFICH√âE

### Dur√©es typiques

| Phase | Dur√©e |
|-------|-------|
| R√©ception requ√™te | 1 ms |
| Middlewares | 2 ms |
| Routage | 1 ms |
| Authentification | 5 ms |
| Requ√™tes SQL | 15 ms |
| Rendu template | 80 ms |
| Envoi r√©ponse | 5 ms |
| **Total serveur** | **~110 ms** |
| Chargement CSS/JS | 20 ms |
| Parsing HTML | 10 ms |
| Calcul layout | 15 ms |
| Peinture | 5 ms |
| **Total navigateur** | **~50 ms** |
| **TOTAL** | **~160 ms** |

---

## üîÑ R√âSUM√â VISUEL DU FLUX

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üåê NAVIGATEUR                                                ‚îÇ
‚îÇ    Utilisateur clique sur "Nouvelle Demande"                ‚îÇ
‚îÇ    GET /api/v1/rh/demandes/new                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üåç TCP/IP                                                    ‚îÇ
‚îÇ    Transmission sur le r√©seau                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üöÄ UVICORN (Port 9000)                                       ‚îÇ
‚îÇ    - Accepte la connexion                                   ‚îÇ
‚îÇ    - Parse la requ√™te HTTP                                  ‚îÇ
‚îÇ    - Cr√©e l'objet Request                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üõ°Ô∏è MIDDLEWARES                                              ‚îÇ
‚îÇ    1. Logging : üì• GET /api/v1/rh/demandes/new             ‚îÇ
‚îÇ    2. CORS (si activ√©)                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üó∫Ô∏è ROUTAGE                                                  ‚îÇ
‚îÇ    FastAPI cherche la route                                ‚îÇ
‚îÇ    ‚Üí Trouv√© : rh_new_demande()                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üîê D√âPENDANCES                                              ‚îÇ
‚îÇ    1. get_session() ‚Üí Session DB                            ‚îÇ
‚îÇ    2. get_current_user()                                    ‚îÇ
‚îÇ       ‚îú‚îÄ Lire cookie access_token                          ‚îÇ
‚îÇ       ‚îú‚îÄ D√©coder JWT                                        ‚îÇ
‚îÇ       ‚îú‚îÄ SQL: SELECT * FROM user WHERE id = 1              ‚îÇ
‚îÇ       ‚îî‚îÄ Retour: User(id=1, email="admin@...")            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üéØ FONCTION rh_new_demande()                                ‚îÇ
‚îÇ    1. SQL: SELECT * FROM request_type_custom               ‚îÇ
‚îÇ    2. Grouper par cat√©gorie                                ‚îÇ
‚îÇ    3. SQL: SELECT * FROM agent_complet WHERE id = 1        ‚îÇ
‚îÇ    4. Pr√©parer le contexte                                 ‚îÇ
‚îÇ    5. Retourner templates.TemplateResponse(...)            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üé® JINJA2                                                    ‚îÇ
‚îÇ    1. Charger rh_demande_new.html                          ‚îÇ
‚îÇ    2. Appliquer layouts/base.html                          ‚îÇ
‚îÇ    3. Remplacer {{ variables }}                            ‚îÇ
‚îÇ    4. Ex√©cuter {% for %} loops                             ‚îÇ
‚îÇ    5. G√©n√©rer HTML final (15 Ko)                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üì§ R√âPONSE HTTP                                             ‚îÇ
‚îÇ    HTTP/1.1 200 OK                                          ‚îÇ
‚îÇ    Content-Type: text/html; charset=utf-8                  ‚îÇ
‚îÇ    Content-Length: 15234                                    ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ    <!DOCTYPE html>                                          ‚îÇ
‚îÇ    <html>...</html>                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üõ°Ô∏è MIDDLEWARES (retour)                                    ‚îÇ
‚îÇ    Logging : üì§ Status: 200 | Duration: 0.125s            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üåç TCP/IP                                                    ‚îÇ
‚îÇ    Transmission de la r√©ponse                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üåê NAVIGATEUR                                                ‚îÇ
‚îÇ    1. Parse HTML ‚Üí DOM                                      ‚îÇ
‚îÇ    2. Requ√™tes: /static/css/style.css, forms.css, app.js  ‚îÇ
‚îÇ    3. Apply CSS ‚Üí CSSOM                                     ‚îÇ
‚îÇ    4. Layout ‚Üí Render Tree                                  ‚îÇ
‚îÇ    5. Paint ‚Üí Pixels √† l'√©cran                             ‚îÇ
‚îÇ    6. Execute JavaScript                                    ‚îÇ
‚îÇ    7. ‚úÖ PAGE AFFICH√âE (160ms total)                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä M√âTRIQUES DE PERFORMANCE

### Logs serveur

```
üì• GET /api/v1/rh/demandes/new | Request-ID: xY7k9mN2
üì§ GET /api/v1/rh/demandes/new | Status: 200 | Duration: 0.125s | Request-ID: xY7k9mN2
üì• GET /static/css/style.css | Request-ID: aB3f8pQ1
üì§ GET /static/css/style.css | Status: 200 | Duration: 0.008s | Request-ID: aB3f8pQ1
üì• GET /static/css/forms.css | Request-ID: cD5h2rT9
üì§ GET /static/css/forms.css | Status: 200 | Duration: 0.006s | Request-ID: cD5h2rT9
üì• GET /static/js/app.js | Request-ID: eF7j4sU3
üì§ GET /static/js/app.js | Status: 200 | Duration: 0.007s | Request-ID: eF7j4sU3
```

### Optimisations possibles

1. **Cache SQL** : Mettre en cache les types de demandes (Redis)
2. **CDN** : Servir les CSS/JS via un CDN
3. **Compression** : Activer gzip pour HTML/CSS/JS
4. **HTTP/2** : Multiplexage des requ√™tes CSS/JS
5. **Lazy loading** : Charger le JavaScript apr√®s le DOM

---

## üîç POINTS CL√âS

### S√©curit√©
- ‚úÖ Authentification JWT v√©rifie √† chaque requ√™te
- ‚úÖ Cookie `httpOnly` emp√™che le XSS
- ‚úÖ Validation des donn√©es avec Pydantic
- ‚úÖ SQL param√©tr√© emp√™che l'injection SQL

### Performance
- ‚úÖ Requ√™tes SQL optimis√©es (index, select sp√©cifique)
- ‚úÖ Session DB r√©utilis√©e (pas de nouvelle connexion √† chaque requ√™te)
- ‚úÖ Templates compil√©s et mis en cache par Jinja2
- ‚úÖ Fichiers statiques servis directement (pas de Python)

### Debugging
- ‚úÖ Request-ID unique pour tracer chaque requ√™te
- ‚úÖ Logs d√©taill√©s (m√©thode, path, statut, dur√©e)
- ‚úÖ Exceptions captur√©es et logu√©es
- ‚úÖ Mode `--reload` pour hot-reload

---

## üìö FICHIERS IMPLIQU√âS

| Fichier | R√¥le dans le flux |
|---------|-------------------|
| `app/main.py` | Middlewares, routage |
| `app/api/v1/router.py` | Enregistrement des routes |
| `app/api/v1/endpoints/rh.py` | Fonction `rh_new_demande()` |
| `app/api/v1/endpoints/auth.py` | Authentification `get_current_user()` |
| `app/db/session.py` | Session DB `get_session()` |
| `app/models/rh.py` | Mod√®les `HRRequest`, `RequestTypeCustom` |
| `app/models/personnel.py` | Mod√®le `AgentComplet` |
| `app/templates/pages/rh_demande_new.html` | Template de la page |
| `app/templates/layouts/base.html` | Layout de base |
| `app/static/css/style.css` | Styles globaux |
| `app/static/js/app.js` | JavaScript global |

---

**Prochaine √©tape** : Voir `03_MODULES_DETAILS.md` pour une explication d√©taill√©e de chaque module du projet.


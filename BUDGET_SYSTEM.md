# üí∞ Syst√®me de Gestion Budg√©taire

## üìã Vue d'Ensemble

Syst√®me complet de **gestion budg√©taire** et **conf√©rences budg√©taires** pour pr√©parer, suivre et ex√©cuter le budget annuel.

---

## üéØ Composantes Principales

### **1. Suivi Budg√©taire** üìä
Dashboard de suivi de l'ex√©cution budg√©taire en cours d'ann√©e :
- Budget vot√©
- Engagements
- Mandats vis√©s
- Mandats PEC (Pris En Charge)
- Disponible
- Taux d'ex√©cution

### **2. Conf√©rences Budg√©taires** ü§ù
Gestion des conf√©rences pour pr√©parer le budget de l'ann√©e N+1 :
- **Conf√©rences internes** : Avec les programmes pour d√©finir leurs besoins
- **Conf√©rences minist√©rielles** : Validation officielle au niveau minist√®re

### **3. Fiches Techniques** üìã
Documents structur√©s de demande budg√©taire :
- Budget ann√©e pr√©c√©dente (N-1)
- Enveloppe demand√©e
- Compl√©ments demand√©s
- Engagements de l'√âtat
- Financements bailleurs de fonds
- Note justificative
- Pi√®ces jointes

### **4. Import Excel** üì•
Chargement des activit√©s et natures de d√©penses depuis Excel

### **5. Export PDF** üìÑ
Impression des fiches techniques en PDF

---

## üèóÔ∏è Mod√®les de Donn√©es

### **1. NatureDepense** (R√©f√©rentiel)
```python
{
    "id": 1,
    "code": "BS",  # BS, P, I, T
    "libelle": "Biens et Services",
    "description": "Fournitures, entretien, services",
    "actif": true
}
```

**4 Natures de d√©pense** :
- **BS** : Biens et Services
- **P** : Personnel
- **I** : Investissement
- **T** : Transferts

### **2. Activite** (R√©f√©rentiel - Import Excel)
```python
{
    "id": 1,
    "code": "ACT001",
    "libelle": "Maintenance informatique",
    "programme_id": 1,
    "direction_id": 2,
    "nature_depense_id": 1,  # BS
    "description": "Entretien parc informatique",
    "actif": true
}
```

### **3. FicheTechnique** (Document central)
```python
{
    "id": 1,
    "numero_fiche": "FT-2026-P01-001",
    "annee_budget": 2026,
    "programme_id": 1,
    "direction_id": 2,
    
    # Budget
    "budget_anterieur": 100000000,        # Budget 2025
    "enveloppe_demandee": 120000000,      # Base demand√©e
    "complement_demande": 15000000,        # Compl√©ments
    "engagement_etat": 5000000,            # Projets garantis
    "financement_bailleurs": 10000000,     # Bailleurs
    "budget_total_demande": 150000000,     # TOTAL (auto)
    
    # Justification
    "note_justificative": "...",
    "observations": "...",
    
    # Statut
    "statut": "Brouillon",  # Brouillon, Soumis, Valid√©, Rejet√©, Approuv√©
    "phase": "Conf√©rence interne",
    
    # Dates
    "date_creation": "2025-10-13",
    "date_soumission": null,
    "date_validation": null
}
```

### **4. LigneBudgetaire** (D√©tail des d√©penses)
```python
{
    "id": 1,
    "fiche_technique_id": 1,
    "activite_id": 5,
    "nature_depense_id": 1,  # BS
    "libelle": "Achat ordinateurs",
    
    "budget_n_moins_1": 5000000,   # Budget 2025
    "budget_demande": 8000000,     # Demand√© 2026
    "budget_valide": 7000000,      # Valid√© apr√®s conf√©rence
    
    "justification": "Renouvellement parc informatique",
    "priorite": "√âlev√©e",
    "ordre": 1
}
```

### **5. DocumentBudget** (Pi√®ces jointes)
```python
{
    "id": 1,
    "fiche_technique_id": 1,
    "type_document": "Devis",
    "nom_fichier": "devis_ordinateurs_2026.pdf",
    "file_path": "/static/uploads/budget/fiches/1/devis_ordinateurs_2026.pdf",
    "taille_octets": 245678,
    "uploaded_by_user_id": 1,
    "uploaded_at": "2025-10-13 15:30:00"
}
```

### **6. ExecutionBudgetaire** (Suivi mensuel)
```python
{
    "id": 1,
    "annee": 2025,
    "mois": 6,
    "periode": "2025-06",
    
    "programme_id": 1,
    "direction_id": 2,
    "nature_depense_id": 1,
    
    "budget_vote": 123849000000,      # Budget vot√©
    "engagements": 55094000000,       # Engagements pris
    "mandats_vises": 54232000000,     # Mandats vis√©s
    "mandats_pec": 50538000000,       # Mandats pay√©s
    "disponible": 68756000000,        # Restant
    
    "taux_engagement": 44.48,         # %
    "taux_mandatement": 40.79,        # %
    "taux_execution": 40.79           # %
}
```

### **7. ConferenceBudgetaire** (Sessions)
```python
{
    "id": 1,
    "numero_conference": "CB-2026-INT-001",
    "type_conference": "Interne",
    "annee_budget": 2026,
    "programme_id": 1,
    "date_conference": "2025-11-15",
    "ordre_du_jour": "R√©vision budget P01",
    "compte_rendu": "...",
    "decisions": "...",
    "statut": "Termin√©e"
}
```

---

## üõ£Ô∏è Routes et Endpoints

### **Dashboard**
```
GET /api/v1/budget/                    # Dashboard suivi budg√©taire
  ?annee=2025                          # Filtre ann√©e
  &programme_id=1                       # Filtre programme
```

### **Fiches Techniques**
```
GET  /api/v1/budget/fiches                  # Liste des fiches
GET  /api/v1/budget/fiches/nouveau          # Formulaire cr√©ation
GET  /api/v1/budget/fiches/{id}             # D√©tail d'une fiche

POST /api/v1/budget/api/fiches              # Cr√©er fiche
PUT  /api/v1/budget/api/fiches/{id}         # Modifier fiche
DELETE /api/v1/budget/api/fiches/{id}       # Supprimer fiche
```

### **Lignes Budg√©taires**
```
POST   /api/v1/budget/api/fiches/{id}/lignes           # Ajouter ligne
PUT    /api/v1/budget/api/fiches/{id}/lignes/{lid}     # Modifier ligne
DELETE /api/v1/budget/api/fiches/{id}/lignes/{lid}     # Supprimer ligne
```

### **Documents**
```
POST /api/v1/budget/api/fiches/{id}/documents    # Upload document
```

### **Export**
```
GET /api/v1/budget/api/fiches/{id}/export/pdf   # Export PDF
```

### **Import**
```
POST /api/v1/budget/api/import/activites         # Import Excel activit√©s
```

### **Conf√©rences**
```
GET  /api/v1/budget/conferences                  # Liste des conf√©rences
POST /api/v1/budget/api/conferences              # Cr√©er conf√©rence
```

---

## üìù Workflow Complet

### **Phase 1 : Pr√©paration (Octobre-Novembre)**

#### **√âtape 1** : Cr√©er les Fiches Techniques
```
1. Budget ‚Üí Fiches Techniques ‚Üí ‚ûï Nouvelle Fiche
2. Remplir:
   - Ann√©e budget: 2026
   - Programme: P01
   - Direction: DAF
   - Budget ant√©rieur: 100 000 000 FCFA
   - Enveloppe demand√©e: 120 000 000 FCFA
   - Compl√©ments: 15 000 000 FCFA
   - Engagements √âtat: 5 000 000 FCFA
   - Bailleurs: 10 000 000 FCFA
   ‚Üí TOTAL: 150 000 000 FCFA (calcul√© auto)
3. Note justificative: Texte explicatif
4. üíæ Enregistrer
```

**R√©sultat** :
- ‚úÖ Fiche cr√©√©e : FT-2026-P01-001
- ‚úÖ Statut: Brouillon
- ‚úÖ Phase: Conf√©rence interne

---

#### **√âtape 2** : Ajouter les Lignes de D√©penses
```
1. Ouvrir la fiche ‚Üí ‚ûï Ajouter une Ligne
2. Remplir:
   - Nature: BS (Biens et Services)
   - Activit√©: Maintenance informatique
   - Libell√©: Achat 10 ordinateurs HP
   - Budget N-1: 5 000 000 FCFA
   - Budget demand√©: 8 000 000 FCFA
   - Priorit√©: √âlev√©e
   - Justification: Renouvellement parc obsol√®te
3. üíæ Enregistrer
4. R√©p√©ter pour chaque ligne
```

**R√©sultat** :
- ‚úÖ Ligne ajout√©e au d√©tail de la fiche
- ‚úÖ Visible dans le tableau
- ‚úÖ Total calcul√© automatiquement

---

#### **√âtape 3** : Joindre les Documents
```
1. Dans la fiche ‚Üí üì§ Upload
2. S√©lectionner type: Devis
3. Choisir fichier: devis_ordinateurs.pdf
4. Upload
5. R√©p√©ter pour:
   - Factures proforma
   - Notes justificatives
   - Plans d'action
   - Rapports
```

**R√©sultat** :
- ‚úÖ Documents stock√©s dans `/static/uploads/budget/fiches/{id}/`
- ‚úÖ Taille et date enregistr√©es
- ‚úÖ T√©l√©chargeables depuis la fiche

---

### **Phase 2 : Conf√©rences Internes (Novembre-D√©cembre)**

#### **Organiser une Conf√©rence**
```
1. Budget ‚Üí Conf√©rences ‚Üí ‚ûï Nouvelle Conf√©rence
2. Remplir:
   - Type: Interne
   - Ann√©e: 2026
   - Programme: P01
   - Date: 2025-11-15
   - Ordre du jour: R√©vision budget P01
3. üíæ Cr√©er
```

**R√©sultat** :
- ‚úÖ Conf√©rence cr√©√©e : CB-2026-INT-001
- ‚úÖ Statut: Planifi√©e

---

#### **Pendant la Conf√©rence**
```
Actions possibles:
1. Consulter les fiches du programme
2. Examiner les pi√®ces justificatives
3. Modifier les lignes budg√©taires:
   - Augmenter/Diminuer montants
   - Ajouter nouvelles lignes
   - Supprimer lignes non prioritaires
4. Discuter et d√©cider
5. Valider ou demander r√©visions
```

---

#### **Apr√®s la Conf√©rence**
```
1. Mettre √† jour les lignes:
   - budget_demande ‚Üí budget_valide
2. Changer statut fiche: Brouillon ‚Üí Valid√©
3. Ajouter compte-rendu et d√©cisions
```

**R√©sultat** :
- ‚úÖ Fiche valid√©e en interne
- ‚úÖ Historique complet des modifications
- ‚úÖ Pr√™te pour conf√©rence minist√©rielle

---

### **Phase 3 : Import Excel des Activit√©s**

#### **Pr√©parer le Fichier Excel**
```
Colonnes requises:
- Code (obligatoire)
- Libelle (obligatoire)
- Programme (optionnel)
- Direction (optionnel)
- Nature (optionnel)
- Description (optionnel)

Exemple:
| Code    | Libelle                  | Programme | Direction | Nature | Description              |
|---------|--------------------------|-----------|-----------|--------|--------------------------|
| ACT001  | Maintenance informatique | P01       | DAF       | BS     | Entretien parc IT        |
| ACT002  | Formation personnel      | P01       | DRH       | P      | Formation continue       |
| ACT003  | Achat v√©hicules          | P02       | LOG       | I      | Renouvellement flotte    |
```

#### **Importer**
```
1. Fiches Techniques ‚Üí üì• Importer Activit√©s Excel
2. S√©lectionner fichier .xlsx
3. Cliquer "üì• Importer"
4. Voir r√©sultat:
   - X activit√©(s) cr√©√©e(s)
   - Y activit√©(s) mise(s) √† jour
   - Erreurs √©ventuelles
```

**R√©sultat** :
- ‚úÖ Activit√©s en base de donn√©es
- ‚úÖ Disponibles dans les selects
- ‚úÖ Li√©es aux programmes/directions/natures

---

### **Phase 4 : Export PDF de la Fiche**

#### **G√©n√©rer le PDF**
```
1. Ouvrir une fiche technique
2. Cliquer "üìÑ Exporter en PDF"
3. Nouvelle fen√™tre s'ouvre
4. Impression automatique (Ctrl+P)
5. Enregistrer en PDF ou imprimer papier
```

**Contenu du PDF** :
```
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     FICHE TECHNIQUE BUDG√âTAIRE
     FT-2026-P01-001
     Budget 2026
     Programme: Administration G√©n√©rale
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

R√âCAPITULATIF BUDG√âTAIRE (FCFA)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Budget Ann√©e Pr√©c√©dente (2025)  ‚îÇ 100 000 000     ‚îÇ
‚îÇ Enveloppe Demand√©e              ‚îÇ 120 000 000     ‚îÇ
‚îÇ Compl√©ments Demand√©s            ‚îÇ  15 000 000     ‚îÇ
‚îÇ Engagements de l'√âtat           ‚îÇ   5 000 000     ‚îÇ
‚îÇ Financement Bailleurs de Fonds  ‚îÇ  10 000 000     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ BUDGET TOTAL DEMAND√â            ‚îÇ 150 000 000     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

D√âTAIL DES D√âPENSES
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Nature ‚îÇ Libell√©              ‚îÇ Budget   ‚îÇ Demand√©  ‚îÇ Priorit√©‚îÇ
‚îÇ        ‚îÇ                      ‚îÇ N-1      ‚îÇ          ‚îÇ         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ BS     ‚îÇ Achat ordinateurs    ‚îÇ 5 000 000‚îÇ 8 000 000‚îÇ √âlev√©e  ‚îÇ
‚îÇ P      ‚îÇ Formation agents     ‚îÇ 2 000 000‚îÇ 3 000 000‚îÇ Normale ‚îÇ
‚îÇ I      ‚îÇ R√©novation bureaux   ‚îÇ10 000 000‚îÇ12 000 000‚îÇ Critique‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

NOTE JUSTIFICATIVE
Le budget demand√© vise √† moderniser nos infrastructures et
renforcer les capacit√©s du personnel...

Date d'√©dition: 13/10/2025
Statut: Brouillon
```

---

## üìä Dashboard Budg√©taire

### **KPIs Principaux**

#### **1. Budget Vot√© (BV)**
```
Montant: 123 849 millions FCFA
Pourcentage: 100%
```

#### **2. Engagements (Eng)**
```
Montant: 55 094 millions FCFA
Taux: 44,48%
Interpr√©tation: 44% du budget est d√©j√† engag√©
```

#### **3. Mandats Vis√©s (MV)**
```
Montant: 54 232 millions FCFA
Taux: 107,31%  (des engagements)
```

#### **4. Mandats PEC (MP)**
```
Montant: 50 538 millions FCFA
Taux: 92,41%  (des mandats vis√©s)
Interpr√©tation: 92% des mandats sont pay√©s
```

#### **5. Disponible (Dis)**
```
Montant: 68 756 millions FCFA
Taux: 55,52%
Interpr√©tation: 55% du budget reste disponible
```

---

### **Variation N vs N-1**

Graphique en barres montrant l'√©volution :
- **Taux Engagement** : -50% (diminution)
- **Taux MV** : +7% (augmentation)
- **Taux M.PEC** : -7% (diminution)
- **Taux E.G** : +50% (augmentation)

---

### **Ex√©cution par Programme**

Barres horizontales de progression :
```
AG (Administration G√©n√©rale)    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 57,39%
GEPN (Gestion Personnel)        ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë 55,77%
PE (Politique √âconomique)       ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë 48,05%
```

---

### **Nature de D√©penses**

Vue lat√©rale (right rail) :
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ BS  Biens & Services            ‚îÇ
‚îÇ     Budget: 26 223 M            ‚îÇ
‚îÇ                      64,32%     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ P   Personnel                   ‚îÇ
‚îÇ     Budget: 15 471 M            ‚îÇ
‚îÇ                      76,19%     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ I   Investissement              ‚îÇ
‚îÇ     Budget: 25 794 M            ‚îÇ
‚îÇ                      35,23%     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ T   Transferts                  ‚îÇ
‚îÇ     Budget: 56 361 M            ‚îÇ
‚îÇ                      55,03%     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ Cycle Budg√©taire

```
Octobre - Novembre : Pr√©paration
    ‚Üì
    ‚îÇ - Cr√©er fiches techniques
    ‚îÇ - Remplir demandes
    ‚îÇ - Joindre documents
    ‚Üì
Novembre - D√©cembre : Conf√©rences Internes
    ‚Üì
    ‚îÇ - Organiser conf√©rences par programme
    ‚îÇ - Examiner les demandes
    ‚îÇ - Discuter et arbitrer
    ‚îÇ - Modifier les montants
    ‚îÇ - Valider les fiches
    ‚Üì
Janvier : Consolidation
    ‚Üì
    ‚îÇ - Consolider toutes les fiches
    ‚îÇ - Pr√©parer projet de budget minist√®re
    ‚Üì
F√©vrier - Mars : Conf√©rences Minist√©rielles
    ‚Üì
    ‚îÇ - Pr√©senter au minist√®re
    ‚îÇ - D√©fendre les demandes
    ‚îÇ - N√©gocier
    ‚îÇ - Validation finale
    ‚Üì
Avril - Mai : Vote Budget
    ‚Üì
    ‚îÇ - Loi de finances
    ‚îÇ - Budget officiellement vot√©
    ‚Üì
Janvier - D√©cembre (Ann√©e N) : Ex√©cution
    ‚Üì
    ‚îÇ - Suivi mensuel
    ‚îÇ - Dashboard mis √† jour
    ‚îÇ - Reporting
```

---

## üì• Format Excel pour Import Activit√©s

### **Colonnes du Fichier**

| Colonne     | Type   | Obligatoire | Exemple                    | Description                    |
|-------------|--------|-------------|----------------------------|--------------------------------|
| Code        | Texte  | ‚úÖ Oui      | ACT001                     | Code unique de l'activit√©      |
| Libelle     | Texte  | ‚úÖ Oui      | Maintenance informatique   | Description de l'activit√©      |
| Programme   | Texte  | ‚ùå Non      | P01                        | Code du programme              |
| Direction   | Texte  | ‚ùå Non      | DAF                        | Code de la direction           |
| Nature      | Texte  | ‚ùå Non      | BS                         | Code nature de d√©pense         |
| Description | Texte  | ‚ùå Non      | Entretien parc IT          | Description d√©taill√©e          |

### **Exemple de Fichier Excel**
```
Feuille 1: Activit√©s

A        | B                        | C    | D   | E  | F
---------|--------------------------|------|-----|----|-----------------------
Code     | Libelle                  | Prog | Dir | Nat| Description
ACT001   | Maintenance informatique | P01  | DAF | BS | Entretien parc IT
ACT002   | Formation personnel      | P01  | DRH | P  | Formation continue
ACT003   | Achat v√©hicules          | P02  | LOG | I  | Renouvellement flotte
ACT004   | Subventions √©coles       | P03  | EDU | T  | Transferts enseignement
```

### **Comment Importer**
```
1. Pr√©parer le fichier Excel (selon format ci-dessus)
2. Budget ‚Üí Fiches Techniques ‚Üí üì• Importer Activit√©s Excel
3. S√©lectionner le fichier
4. Cliquer "üì• Importer"
5. Voir le r√©sultat:
   ‚úÖ 4 activit√©s cr√©√©es
   ‚úÖ 0 activit√©s mises √† jour
   ‚ùå 0 erreurs
```

---

## üé® Interface Utilisateur

### **Dashboard** (Reproduction exacte du fichier HTML)
- Sidebar avec filtres (P√©riode, Programme)
- KPIs avec neumorphism
- Variation N vs N-1 (barres)
- Ex√©cution par programme (barres horizontales)
- Nature de d√©penses (right rail)

### **Liste Fiches**
- Tableau avec filtres
- Actions (Voir, PDF, Supprimer)
- Bouton "‚ûï Nouvelle Fiche"
- Bouton "üì• Importer Activit√©s"

### **D√©tail Fiche**
- R√©capitulatif budg√©taire (grandes cartes)
- Tableau des lignes budg√©taires
- Liste des documents
- Actions (Modifier, Export PDF, Imprimer)

---

## üîí S√©curit√© et Tra√ßabilit√©

### **Authentification**
- ‚úÖ Toutes les pages n√©cessitent une connexion
- ‚úÖ `current_user` v√©rifi√©

### **Tra√ßabilit√© Compl√®te**
```python
# Cr√©ation
fiche.created_by_user_id = current_user.id

# Modification
historique = HistoriqueBudget(
    fiche_technique_id=fiche_id,
    action="Modification",
    ancien_statut="Brouillon",
    nouveau_statut="Valid√©",
    montant_avant=100000000,
    montant_apres=120000000,
    commentaire="Augmentation apr√®s conf√©rence",
    user_id=current_user.id,
    date_action=datetime.now()
)

# Logs
logger.info(f"‚úÖ Fiche {numero} cr√©√©e par {current_user.email}")
logger.info(f"üìÑ Document {filename} upload√© pour fiche {id}")
logger.info(f"üì• Import: {created} cr√©√©es, {updated} mises √† jour")
```

---

## üìä Calculs Automatiques

### **Budget Total de la Fiche**
```python
budget_total_demande = (
    enveloppe_demandee +
    complement_demande +
    engagement_etat +
    financement_bailleurs
)
```

### **Taux d'Ex√©cution**
```python
taux_engagement = (engagements / budget_vote) * 100
taux_mandatement = (mandats_pec / budget_vote) * 100
taux_execution = taux_mandatement  # Simplification
disponible = budget_vote - engagements
```

### **Total Lignes Budg√©taires**
```python
total_demande = sum(ligne.budget_demande for ligne in lignes)
total_valide = sum(ligne.budget_valide for ligne in lignes)
```

---

## üìà Reporting et Analyses

### **Par Programme**
```sql
SELECT programme_id, 
       SUM(budget_vote) as budget_total,
       SUM(mandats_pec) as montant_execute,
       (SUM(mandats_pec) / SUM(budget_vote) * 100) as taux_execution
FROM execution_budgetaire
WHERE annee = 2025
GROUP BY programme_id
ORDER BY taux_execution DESC
```

### **Par Nature de D√©pense**
```sql
SELECT nature_depense_id,
       SUM(budget_vote) as budget_total,
       SUM(engagements) as engagements_total,
       (SUM(engagements) / SUM(budget_vote) * 100) as taux_engagement
FROM execution_budgetaire
WHERE annee = 2025
GROUP BY nature_depense_id
```

### **√âvolution Temporelle**
```sql
SELECT periode,
       SUM(budget_vote) as budget,
       SUM(mandats_pec) as execute,
       (SUM(mandats_pec) / SUM(budget_vote) * 100) as taux
FROM execution_budgetaire
WHERE annee = 2025
GROUP BY periode
ORDER BY periode
```

---

## üöÄ Quick Start

### **1. Cr√©er Premi√®re Fiche**
```
Budget ‚Üí Fiches Techniques ‚Üí ‚ûï Nouvelle Fiche
‚Üí Remplir les montants
‚Üí Enregistrer
‚Üí ‚úÖ Fiche cr√©√©e !
```

### **2. Ajouter D√©tails**
```
Fiche ‚Üí ‚ûï Ajouter une Ligne
‚Üí Remplir nature, libell√©, montant
‚Üí Enregistrer
‚Üí ‚úÖ Ligne ajout√©e !
```

### **3. Joindre Documents**
```
Fiche ‚Üí üì§ Upload
‚Üí S√©lectionner type et fichier
‚Üí Upload
‚Üí ‚úÖ Document upload√© !
```

### **4. Exporter PDF**
```
Fiche ‚Üí üìÑ Exporter en PDF
‚Üí Nouvelle fen√™tre
‚Üí Ctrl+P pour imprimer/enregistrer
‚Üí ‚úÖ PDF g√©n√©r√© !
```

---

## üìÅ Fichiers Cr√©√©s

```
app/models/budget.py                         # 8 mod√®les (270 lignes)
app/api/v1/endpoints/budget.py               # Endpoints (450 lignes)
app/templates/pages/budget_dashboard.html    # Dashboard (550 lignes)
app/templates/pages/budget_fiches.html       # Liste fiches (390 lignes)
app/templates/pages/budget_fiche_form.html   # Formulaire (380 lignes)
app/templates/pages/budget_fiche_detail.html # D√©tail fiche (480 lignes)
app/templates/components/navbar.html         # Bouton connect√©
app/models/__init__.py                       # Imports ajout√©s
app/api/v1/router.py                         # Router budget
BUDGET_SYSTEM.md                             # Ce fichier
```

---

## üéØ Fonctionnalit√©s Cl√©s

### **‚úÖ Impl√©ment√©**
- [x] Mod√®les de donn√©es (8 tables)
- [x] Dashboard de suivi budg√©taire
- [x] Cr√©ation de fiches techniques
- [x] Ajout/Modification/Suppression de lignes
- [x] Upload de documents multiples
- [x] Import Excel activit√©s
- [x] Export PDF de fiche
- [x] Historique des modifications
- [x] Conf√©rences budg√©taires
- [x] Bouton navbar connect√©
- [x] 4 natures de d√©pense initialis√©es

### **üîú √Ä Venir** (si n√©cessaire)
- [ ] Graphiques d'√©volution (Chart.js)
- [ ] Export Excel consolid√©
- [ ] Notifications de changement de statut
- [ ] Workflow de validation (√©tapes)
- [ ] Comparaison N vs N-1 d√©taill√©e
- [ ] API pour int√©gration externe

---

**üí∞ Syst√®me de Gestion Budg√©taire Production-Ready !**

Dashboard ‚úÖ | Fiches Techniques ‚úÖ | Import Excel ‚úÖ | Export PDF ‚úÖ | Conf√©rences ‚úÖ


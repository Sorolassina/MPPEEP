{% extends "layouts/base.html" %}

{% block title %}Fiches Techniques Budg√©taires - {{ app_name }}{% endblock %}

{% block content %}
<div class="page-grid">
  
  <!-- En-t√™te -->
  <div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
      <h1 style="margin: 0;">üìã Fiches Techniques Budg√©taires</h1>
      <a href="{{ url_for('budget_home') }}" class="btn-back" title="Retour au Budget">
        <span style="font-size: 1.2rem;">‚Üê</span> Retour
      </a>
    </div>
    <p style="color: #6c757d; margin: 0; margin-bottom: 1.5rem;">
      G√©rez les fiches techniques avec structure hi√©rarchique : Natures ‚Üí Actions ‚Üí Services ‚Üí Activit√©s ‚Üí Lignes
    </p>

    <!-- Boutons d'action -->
    <div style="display: flex; gap: 1rem; align-items: center;">
      <button onclick="document.getElementById('chargerModal').classList.add('show')" class="btn-primary" style="background: linear-gradient(135deg, #10b981, #059669);">
        üìÇ Charger une Fiche
      </button>
      <button onclick="reinitialiserFiltres()" class="btn-primary" style="
        background: white;
        color: #e74c3c;
        border: 2px solid #e74c3c;
      " onmouseover="this.style.background='#e74c3c'; this.style.color='white'" onmouseout="this.style.background='white'; this.style.color='#e74c3c'">
        üîÑ R√©initialiser
      </button>
      <span style="color: #7f8c8d; font-size: 0.95rem; font-weight: 600; margin-left: auto;">({{ fiches|length }} fiche(s))</span>
    </div>
  </div>

  <!-- Filtres -->
  <div class="card">
    <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
      <!-- Filtre Ann√©e -->
      <div style="display: flex; gap: 0.5rem; align-items: center;">
        <label style="font-weight: 600; color: #2c3e50;">üìÖ Ann√©e :</label>
        <select id="filter-annee" onchange="filtrerFiches()" style="
          padding: 0.75rem 1rem; 
          border: 2px solid #e0e0e0; 
          border-radius: 10px; 
          cursor: pointer; 
          font-weight: 500;
          min-width: 180px;
          background: white;
          font-size: 1rem;
        ">
          <option value="toutes" {{ 'selected' if annee == 'toutes' else '' }}>üìã Toutes</option>
          {% for a in annees_disponibles %}
          <option value="{{ a }}" {{ 'selected' if annee|string == a|string else '' }}>{{ a }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Filtre Programme -->
      <div style="display: flex; gap: 0.5rem; align-items: center;">
        <label style="font-weight: 600; color: #2c3e50;">üìä Programme :</label>
        <select id="filter-programme" onchange="filtrerFiches()" style="
          padding: 0.75rem 1rem; 
          border: 2px solid #e0e0e0; 
          border-radius: 10px; 
          cursor: pointer; 
          font-weight: 500;
          min-width: 180px;
          background: white;
          font-size: 1rem;
        ">
          <option value="tous" {{ 'selected' if programme_id == 'tous' else '' }}>üìã Tous</option>
          {% for p in programmes_list %}
          <option value="{{ p.id }}" {{ 'selected' if programme_id|string == p.id|string else '' }}>{{ p.code }} - {{ p.libelle[:30] }}...</option>
          {% endfor %}
        </select>
      </div>
    </div>
  </div>

  <!-- Liste des fiches -->
  <div class="card">
    <h3 style="margin-bottom: 1.5rem;">üìä Fiches Techniques {% if annee == 'toutes' %}(Toutes ann√©es){% else %}{{ annee }}{% endif %}</h3>
    
    {% if fiches %}
    <div class="data-table">
      <table>
        <thead>
          <tr>
            <th>Num√©ro</th>
            <th>Ann√©e</th>
            <th>Programme</th>
            <th>Budget Total</th>
            <th>Phase</th>
            <th>Statut</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for f in fiches %}
          <tr>
            <td><strong>{{ f.numero_fiche }}</strong></td>
            <td><span class="badge badge-info">{{ f.annee_budget }}</span></td>
            <td>
              {% if f.programme_id in programmes %}
                <strong>{{ programmes[f.programme_id].libelle }}</strong><br>
                <small style="color: #6c757d;">({{ programmes[f.programme_id].code }})</small>
              {% else %}
                -
              {% endif %}
            </td>
            <td><strong style="color: #27ae60;">{{ "{:,.0f}".format(f.budget_total_demande) }} FCFA</strong></td>
            <td><span class="badge badge-info">{{ f.phase }}</span></td>
            <td>
              {% if f.statut == 'Brouillon' %}
                <span class="badge badge-secondary">{{ f.statut }}</span>
              {% elif f.statut == 'Soumis' %}
                <span class="badge badge-warning">{{ f.statut }}</span>
              {% elif f.statut == 'Valid√©' or f.statut == 'Approuv√©' %}
                <span class="badge badge-success">{{ f.statut }}</span>
              {% else %}
                <span class="badge badge-danger">{{ f.statut }}</span>
              {% endif %}
            </td>
            <td>{{ f.date_creation.strftime('%d/%m/%Y') }}</td>
            <td>
              <div class="action-icons">
                <span class="action-icon" onclick="voirFiche({{ f.id }})" title="Voir structure">üëÅÔ∏è</span>
                <span class="action-icon" onclick="exporterPDF({{ f.id }})" title="Exporter PDF">üìÑ</span>
                <span class="action-icon" onclick="gererDocumentsFiche({{ f.id }})" title="G√©rer documents">üìé</span>
                <span class="action-icon" onclick="supprimerFiche({{ f.id }})" title="Supprimer">üóëÔ∏è</span>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="empty-state">
      <div class="empty-state-icon">üìã</div>
      <p><strong>Aucune fiche technique {% if annee != 'toutes' %}pour {{ annee }}{% endif %}</strong></p>
      <p>Chargez une fiche existante ou cr√©ez votre premi√®re fiche technique</p>
    </div>
    {% endif %}
  </div>

</div>

<!-- Modal Charger Fiche -->
<div id="chargerModal" class="modal-overlay">
  <div class="modal-content" style="max-width: 700px;">
    <div class="modal-header">
      <h2>üìÇ Charger une Fiche Technique</h2>
      <button class="modal-close" onclick="closeChargerModal()">&times;</button>
    </div>
    
    <div style="padding: 1rem; background: #e3f2fd; border-radius: 10px; margin-bottom: 1rem;">
      <strong>üìã Processus de chargement :</strong>
      <ol style="margin: 0.5rem 0; padding-left: 1.5rem;">
        <li><strong>Analyse automatique</strong> : Le syst√®me analyse le fichier et d√©tecte la structure</li>
        <li><strong>Reconnaissance des colonnes</strong> : Identification des colonnes cl√©s (Code, Libell√©, Montants)</li>
        <li><strong>Hi√©rarchisation</strong> : Organisation en Actions ‚Üí Services ‚Üí Activit√©s ‚Üí Lignes</li>
        <li><strong>Validation</strong> : V√©rification des donn√©es et cr√©ation du tableau</li>
      </ol>
    </div>
    
    <div style="padding: 1rem; background: #fff3cd; border-radius: 10px; margin-bottom: 1rem; border-left: 4px solid #ffc107;">
      <strong>üìù Format requis pour le fichier Excel :</strong>
      
      <div style="margin-top: 0.75rem;">
        <strong>üèóÔ∏è Structure hi√©rarchique (ordre exact) :</strong>
        <ol style="margin: 0.5rem 0; padding-left: 1.5rem;">
          <li><strong>Nature de D√©penses</strong> : BIENS ET SERVICES, PERSONNEL, INVESTISSEMENT, TRANSFERTS</li>
          <li><strong>Actions</strong> : Commencent par <code>Action :</code> ou <code>- Action :</code></li>
          <li><strong>Services B√©n√©ficiaires</strong> : Commencent par <code>Service B√©n√©ficiaire :</code> ou <code>- Service B√©n√©ficiaire :</code></li>
          <li><strong>Activit√©s</strong> : Commencent par <code>Activit√© :</code> ou <code>- Activit√© :</code></li>
          <li><strong>Lignes budg√©taires</strong> : Commencent par un <strong>num√©ro de compte</strong> (ex: 601100, 621200)</li>
        </ol>
      </div>
      
      <div style="margin-top: 0.75rem;">
        <strong>üìä Colonnes attendues :</strong>
        <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
          <li><strong>CODE ET LIBELLE</strong> : Identification et description</li>
          <li><strong>BUDGET VOT√â N</strong> : Budget vot√© ann√©e pr√©c√©dente (A)</li>
          <li><strong>BUDGET ACTUEL N</strong> : Budget actuel ann√©e pr√©c√©dente (B)</li>
          <li><strong>ENVELOPPE N+1</strong> : Enveloppe demand√©e ann√©e suivante (C)</li>
          <li><strong>COMPL√âMENT SOLLICIT√â</strong> : Demande de compl√©ment (D)</li>
          <li><strong>BUDGET SOUHAIT√â</strong> : Budget souhait√© total (E=C+D)</li>
          <li><strong>ENGAGEMENT √âTAT</strong> : Engagement de l'√âtat (F)</li>
          <li><strong>AUTRE COMPL√âMENT</strong> : Autre source de financement (G)</li>
          <li><strong>PROJET DE BUDGET N+1</strong> : Projet final (H=C+F+G)</li>
          <li><strong>JUSTIFICATIFS</strong> : Notes explicatives</li>
        </ul>
      </div>
      
      <div style="margin-top: 0.75rem; padding: 0.5rem; background: #d1ecf1; border-radius: 5px;">
        <strong>üí° Exemple de structure Excel :</strong><br>
        <code style="font-size: 0.9rem; display: block; margin-top: 0.5rem;">
          <strong>BIENS ET SERVICES</strong><br>
          <strong>Action :</strong> 2208401 Pilotage, suivi et √©valuation...<br>
          &nbsp;&nbsp;<strong>Service B√©n√©ficiaire :</strong> DR BOUAKE<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<strong>Activit√© :</strong> 17011200103 Cordonner les activit√©s...<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>601100</strong> Achats de petits mat√©riels...<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>601200</strong> Achats de carburants...<br>
          <br>
          <strong>PERSONNEL</strong><br>
          <strong>Action :</strong> 2208402 Gestion des ressources humaines...<br>
          &nbsp;&nbsp;<strong>Service B√©n√©ficiaire :</strong> DRH<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<strong>Activit√© :</strong> 17011200104 Gestion du personnel...<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>621100</strong> Salaires et indemnit√©s...
        </code>
      </div>
    </div>
    
    <form id="chargerForm" onsubmit="handleChargerFiche(event)" enctype="multipart/form-data">
      <div class="form-group">
        <label class="required">Programme</label>
        <select name="programme_id" required style="padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 10px; width: 100%;">
          <option value="">-- S√©lectionner un programme --</option>
          {% for p in programmes_list %}
          <option value="{{ p.id }}">{{ p.code }} - {{ p.libelle }}</option>
          {% endfor %}
        </select>
        <small style="color: #6c757d; margin-top: 0.5rem; display: block;">
          Programme budg√©taire auquel rattacher cette fiche
        </small>
      </div>
      
      <div class="form-group">
        <label>Fichier de la fiche technique (.xlsx, .xls, .pdf)</label>
        <input type="file" name="fichier" accept=".xlsx,.xls,.pdf" required>
        <small style="color: #6c757d; margin-top: 0.5rem; display: block;">
          Formats support√©s : Excel (.xlsx, .xls) ou PDF (.pdf)
        </small>
      </div>
      
      <div class="form-group">
        <label>Nom de la fiche (optionnel)</label>
        <input type="text" name="nom_fiche" placeholder="Ex: Fiche DOUANE 2025">
        <small style="color: #6c757d; margin-top: 0.5rem; display: block;">
          Si non renseign√©, le nom sera g√©n√©r√© automatiquement
        </small>
      </div>
      
      <div class="modal-actions" style="margin-top: 1.5rem; padding-top: 1rem; border-top: 2px solid #e0e0e0;">
        <button type="button" class="btn-modal secondary" onclick="closeChargerModal()">Annuler</button>
        <button type="submit" class="btn-modal primary">üìÇ Charger et Analyser</button>
      </div>
    </form>
    
    <div id="chargerResult" style="display: none; margin-top: 1rem; padding: 1rem; border-radius: 10px;"></div>
  </div>
</div>

<!-- Modal G√©rer Documents Fiche -->
<div id="modalDocumentsFiche" class="modal-overlay">
  <div class="modal-content" style="max-width: 900px;">
    <div class="modal-header">
      <h2>üìé Documents de la Fiche Technique</h2>
      <button class="modal-close" onclick="closeModal('modalDocumentsFiche')">&times;</button>
    </div>
    
    <div style="padding: 1rem; background: #e3f2fd; border-radius: 10px; margin-bottom: 1rem;">
      <strong>‚ÑπÔ∏è Information :</strong> G√©rez les documents attach√©s √† cette fiche technique (justificatifs, annexes, etc.)
    </div>
    
    <!-- Formulaire Upload -->
    <form id="formUploadDocumentFiche" onsubmit="handleUploadDocumentFiche(event)" enctype="multipart/form-data" style="margin-bottom: 2rem;">
      <input type="hidden" id="doc_fiche_id" name="fiche_id">
      
      <div class="form-group">
        <label class="required">Fichier</label>
        <input type="file" name="fichier" required accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 10px;">
        <small style="color: #6c757d; display: block; margin-top: 0.5rem;">
          Formats accept√©s : PDF, Word, Excel, Images (max 10 MB)
        </small>
      </div>
      
      <div class="form-group">
        <label>Description</label>
        <input type="text" name="description" placeholder="Description du document (optionnel)" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 10px;">
      </div>
      
      <button type="submit" class="btn-modal primary" style="width: 100%;">
        üì§ Uploader le Document
      </button>
    </form>
    
    <!-- Liste des documents -->
    <div style="border-top: 2px solid #e0e0e0; padding-top: 1rem;">
      <h3 style="margin-bottom: 1rem;">üìã Documents existants</h3>
      <div id="listeDocumentsFiche" style="max-height: 400px; overflow-y: auto;">
        <!-- Sera rempli dynamiquement -->
      </div>
    </div>
  </div>
</div>


{% endblock %}

{% block scripts %}
<script>
function filtrerFiches() {
  const annee = document.getElementById('filter-annee').value;
  const programmeId = document.getElementById('filter-programme').value;
  
  // Construire l'URL avec les param√®tres
  let url = `/api/v1/budget/fiches/hierarchique?annee=${annee}`;
  if (programmeId !== 'tous') {
    url += `&programme_id=${programmeId}`;
  }
  
  showGlobalLoading('Filtrage...', 'Chargement des fiches');
  setTimeout(() => {
    window.location.href = url;
  }, 300);
}

function reinitialiserFiltres() {
  showGlobalLoading('R√©initialisation...', 'Chargement de toutes les fiches');
  setTimeout(() => {
    window.location.href = '/api/v1/budget/fiches/hierarchique?annee=toutes';
  }, 300);
}

function voirFiche(ficheId) {
  showGlobalLoading('Chargement...', 'Ouverture de la fiche');
  setTimeout(() => {
    window.location.href = `/api/v1/budget/fiches/${ficheId}/structure`;
  }, 300);
}

function exporterPDF(ficheId) {
  showGlobalLoading('G√©n√©ration PDF...', 'Veuillez patienter');
  setTimeout(() => {
    window.open(`/api/v1/budget/api/fiches/${ficheId}/export/pdf`, '_blank');
    hideGlobalLoading();
  }, 500);
}

async function gererDocumentsFiche(ficheId) {
  document.getElementById('doc_fiche_id').value = ficheId;
  document.getElementById('modalDocumentsFiche').classList.add('show');
  document.getElementById('formUploadDocumentFiche').reset();
  document.getElementById('doc_fiche_id').value = ficheId;
  
  // Charger les documents existants
  await chargerDocumentsFiche(ficheId);
}

async function chargerDocumentsFiche(ficheId) {
  try {
    const response = await fetch(`/api/v1/budget/api/fiches/${ficheId}/documents`);
    const result = await response.json();
    
    const listeDiv = document.getElementById('listeDocumentsFiche');
    
    if (response.ok && result.documents && result.documents.length > 0) {
      listeDiv.innerHTML = result.documents.map(doc => `
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 10px; margin-bottom: 0.5rem;">
          <div style="flex: 1;">
            <strong>üìÑ ${doc.filename || doc.nom_fichier || 'Document'}</strong>
            ${doc.description ? `<br><small style="color: #6c757d;">${doc.description}</small>` : ''}
            <br><small style="color: #6c757d;">Upload√© le ${new Date(doc.date_upload || doc.created_at).toLocaleDateString('fr-FR')}</small>
          </div>
          <div style="display: flex; gap: 0.5rem;">
            <button onclick="telechargerDocument(${ficheId}, ${doc.id})" class="btn-modal secondary" style="padding: 0.5rem 1rem;">
              üì• T√©l√©charger
            </button>
            <button onclick="supprimerDocumentFiche(${ficheId}, ${doc.id})" class="btn-modal secondary" style="padding: 0.5rem 1rem; background: #e74c3c; border-color: #e74c3c;">
              üóëÔ∏è Supprimer
            </button>
          </div>
        </div>
      `).join('');
    } else {
      listeDiv.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 2rem;">Aucun document attach√© √† cette fiche.</p>';
    }
  } catch (error) {
    console.error('Erreur chargement documents:', error);
    document.getElementById('listeDocumentsFiche').innerHTML = '<p style="text-align: center; color: #e74c3c; padding: 2rem;">Erreur lors du chargement des documents.</p>';
  }
}

async function handleUploadDocumentFiche(event) {
  event.preventDefault();
  const formData = new FormData(event.target);
  const ficheId = formData.get('fiche_id');
  
  showGlobalLoading('Upload...', 'Upload du document en cours');
  
  try {
    const response = await fetch(`/api/v1/budget/api/fiches/${ficheId}/documents`, {
      method: 'POST',
      body: formData
    });
    
    const result = await response.json();
    
    if (response.ok && result.ok) {
      hideGlobalLoading();
      showSuccess('‚úÖ Document upload√© avec succ√®s');
      document.getElementById('formUploadDocumentFiche').reset();
      document.getElementById('doc_fiche_id').value = ficheId;
      await chargerDocumentsFiche(ficheId);
    } else {
      hideGlobalLoading();
      await handleFetchError(response, 'Erreur lors de l\'upload');
    }
  } catch (error) {
    hideGlobalLoading();
    console.error('Erreur:', error);
    showError('Erreur r√©seau. V√©rifiez votre connexion.');
  }
}

function telechargerDocument(ficheId, documentId) {
  window.open(`/api/v1/budget/api/fiches/${ficheId}/documents/${documentId}/download`, '_blank');
}

async function supprimerDocumentFiche(ficheId, documentId) {
  if (!confirm('‚ö†Ô∏è Supprimer ce document ?')) return;
  
  showGlobalLoading('Suppression...', 'Suppression du document');
  
  try {
    const response = await fetch(`/api/v1/budget/api/fiches/${ficheId}/documents/${documentId}`, {
      method: 'DELETE'
    });
    
    const result = await response.json();
    
    if (response.ok && result.ok) {
      hideGlobalLoading();
      showSuccess('‚úÖ Document supprim√©');
      await chargerDocumentsFiche(ficheId);
    } else {
      hideGlobalLoading();
      await handleFetchError(response, 'Erreur lors de la suppression');
    }
  } catch (error) {
    hideGlobalLoading();
    console.error('Erreur:', error);
    showError('Erreur r√©seau. V√©rifiez votre connexion.');
  }
}

async function supprimerFiche(ficheId) {
  if (!confirm('‚ö†Ô∏è Supprimer cette fiche technique ?\n\nCette action est irr√©versible.')) return;
  
  showGlobalLoading('Suppression...', 'Veuillez patienter');
  
  try {
    const response = await fetch(`/api/v1/budget/api/fiches/${ficheId}`, {
      method: 'DELETE'
    });
    
    const result = await response.json();
    
    if (response.ok && result.ok) {
      showGlobalLoading('‚úÖ Fiche supprim√©e', 'Actualisation de la page...');
      setTimeout(() => location.reload(), 500);
    } else {
      hideGlobalLoading();
      await handleFetchError(response, 'Erreur lors de la suppression');
    }
  } catch (error) {
    hideGlobalLoading();
    console.error('Erreur:', error);
    showError('Erreur r√©seau. V√©rifiez votre connexion.');
  }
}

async function handleChargerFiche(event) {
  event.preventDefault();
  
  showGlobalLoading('Analyse en cours...', 'Chargement et analyse du fichier');
  
  const formData = new FormData(event.target);
  
  try {
    const response = await fetch('/api/v1/budget/api/charger-fiche', {
      method: 'POST',
      body: formData
    });
    
    const result = await response.json();
    
    if (response.ok && result.ok) {
      const resultDiv = document.getElementById('chargerResult');
      resultDiv.style.display = 'block';
      resultDiv.style.background = '#d4edda';
      resultDiv.style.color = '#155724';
      resultDiv.innerHTML = `
        <strong>‚úÖ Fiche charg√©e avec succ√®s !</strong><br>
        <strong>Fiche cr√©√©e :</strong> ${result.fiche_numero}<br>
        <strong>Actions :</strong> ${result.actions_count}<br>
        <strong>Services :</strong> ${result.services_count}<br>
        <strong>Activit√©s :</strong> ${result.activites_count}<br>
        <strong>Lignes :</strong> ${result.lignes_count}<br>
        <strong>Budget total :</strong> ${result.budget_total.toLocaleString()} FCFA<br>
        ${result.errors.length > 0 ? '<br><strong>‚ö†Ô∏è Avertissements:</strong><br>' + result.errors.join('<br>') : ''}
      `;
      
      closeChargerModal();
      showGlobalLoading('‚úÖ Fiche cr√©√©e', 'Actualisation de la page...');
      setTimeout(() => location.reload(), 1000);
    } else {
      hideGlobalLoading();
      await handleFetchError(response, 'Erreur lors du chargement');
    }
  } catch (error) {
    hideGlobalLoading();
    console.error('Erreur:', error);
    showError('Erreur r√©seau. V√©rifiez votre connexion.');
  }
}


function closeChargerModal() {
  document.getElementById('chargerModal').classList.remove('show');
  document.getElementById('chargerForm').reset();
  document.getElementById('chargerResult').style.display = 'none';
}

function closeModal(modalId) {
  document.getElementById(modalId).classList.remove('show');
}


// Styles modal
const style = document.createElement('style');
style.textContent = `
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    justify-content: center;
    align-items: center;
  }
  
  .modal-overlay.show {
    display: flex;
  }
  
  .modal-content {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
  }
  
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #e0e0e0;
  }
  
  .modal-header h2 {
    margin: 0;
    color: #333;
  }
  
  .modal-close {
    font-size: 2rem;
    color: #6c757d;
    cursor: pointer;
    background: none;
    border: none;
    padding: 0;
    line-height: 1;
  }
  
  .modal-close:hover {
    color: #dc3545;
  }
  
  .form-group {
    display: flex;
    flex-direction: column;
    margin-bottom: 1rem;
  }
  
  .form-group label {
    font-weight: 600;
    margin-bottom: 0.5rem;
  }
  
  .form-group input[type="file"] {
    padding: 0.75rem;
    border: 2px dashed #667eea;
    border-radius: 10px;
    background: #f8f9fa;
  }
  
  .form-group input[type="text"] {
    padding: 0.75rem;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
  }
  
  .modal-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
  }
  
  .btn-modal {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
  }
  
  .btn-modal.primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }
  
  .btn-modal.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
  }
  
  .btn-modal.secondary {
    background: #e9ecef;
    color: #495057;
  }
  
  .btn-modal.secondary:hover {
    background: #dee2e6;
  }
`;
document.head.appendChild(style);

console.log('‚úÖ Page fiches techniques hi√©rarchiques charg√©e');
</script>
{% endblock %}

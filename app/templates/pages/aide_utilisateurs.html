{% extends "layouts/base.html" %}
{% from 'components/page_header.html' import page_header %}

{% block title %}Aide - Gestion des Utilisateurs{% endblock %}

{% block content %}
{{ page_header(
    title='â“ Aide - Gestion des Utilisateurs',
    breadcrumbs=[
        {'name': 'Accueil', 'url': url_for('accueil')},
        {'name': 'Administration'},
        {'name': 'Utilisateurs', 'url': url_for('gestion_utilisateurs')},
        {'name': 'Aide'}
    ],
    actions=[
        {'label': 'â† Retour', 'url': url_for('gestion_utilisateurs'), 'primary': False}
    ]
) }}

<div class="help-container" style="max-width: 1200px; margin: 0 auto; padding: 2rem;">
    
    <!-- Introduction -->
    <div class="card" style="margin-bottom: 2rem; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-left: 4px solid #0ea5e9;">
        <h2 style="color: #0369a1; margin-bottom: 1rem;">ğŸ‘¥ SystÃ¨me de Gestion des Utilisateurs</h2>
        <p style="color: #0c4a6e; line-height: 1.8; font-size: 1.05rem;">
            Le systÃ¨me de gestion des utilisateurs permet de crÃ©er et gÃ©rer les comptes d'accÃ¨s Ã  l'application, 
            de dÃ©finir leurs rÃ´les et permissions, et de les lier aux agents du personnel.
        </p>
    </div>

    <!-- Types d'utilisateurs -->
    <div class="card" style="margin-bottom: 2rem;">
        <h3 style="color: #1f2937; margin-bottom: 1.5rem;">ğŸ­ Types d'Utilisateurs</h3>
        
        <div style="display: grid; gap: 1rem;">
            <div style="padding: 1rem; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 8px;">
                <h4 style="color: #92400e; margin-bottom: 0.5rem;">ğŸ‘‘ Administrateur (admin)</h4>
                <ul style="color: #78350f; margin: 0; padding-left: 1.5rem;">
                    <li>AccÃ¨s complet Ã  tous les modules</li>
                    <li>Gestion des utilisateurs et permissions</li>
                    <li>Configuration du systÃ¨me (workflows, rÃ©fÃ©rentiels, paramÃ¨tres)</li>
                    <li>AccÃ¨s aux logs et statistiques globales</li>
                </ul>
            </div>
            
            <div style="padding: 1rem; background: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 8px;">
                <h4 style="color: #1e40af; margin-bottom: 0.5rem;">ğŸ”§ ModÃ©rateur (moderator)</h4>
                <ul style="color: #1e3a8a; margin: 0; padding-left: 1.5rem;">
                    <li>Gestion des modules opÃ©rationnels (RH, Budget, Stock)</li>
                    <li>Validation des demandes selon les rÃ´les personnalisÃ©s assignÃ©s</li>
                    <li>Consultation des rapports et statistiques</li>
                    <li>Pas d'accÃ¨s Ã  la configuration systÃ¨me</li>
                </ul>
            </div>
            
            <div style="padding: 1rem; background: #d1fae5; border-left: 4px solid #10b981; border-radius: 8px;">
                <h4 style="color: #065f46; margin-bottom: 0.5rem;">ğŸ‘¤ Utilisateur (user)</h4>
                <ul style="color: #064e3b; margin: 0; padding-left: 1.5rem;">
                    <li>AccÃ¨s limitÃ© aux fonctionnalitÃ©s de base</li>
                    <li>CrÃ©ation de demandes (congÃ©s, permissions, besoins)</li>
                    <li>Suivi de ses propres demandes</li>
                    <li>Consultation des informations</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- CrÃ©er un utilisateur -->
    <div class="card" style="margin-bottom: 2rem;">
        <h3 style="color: #1f2937; margin-bottom: 1.5rem;">â• CrÃ©er un Utilisateur</h3>
        
        <h4 style="color: #4b5563; margin-bottom: 1rem;">ğŸ“ MÃ©thode 1 : Ã€ partir d'un agent existant (recommandÃ©)</h4>
        <ol style="line-height: 1.8; color: #374151;">
            <li><strong>Aller dans "Gestion du Personnel"</strong> (<code>/api/v1/personnel/</code>)</li>
            <li><strong>Identifier l'agent</strong> qui n'a pas encore de compte (icÃ´ne <code style="background: #e0f2fe; padding: 0.2rem 0.5rem; border-radius: 4px; color: #3b82f6;">ğŸ‘¤â•</code> bleue)</li>
            <li><strong>Cliquer sur l'icÃ´ne</strong> ğŸ‘¤â• pour ouvrir le modal de crÃ©ation</li>
            <li><strong>Saisir l'email</strong> de connexion (prÃ©-rempli avec suggestion)</li>
            <li><strong>DÃ©finir un mot de passe</strong> :
                <ul>
                    <li>Soit saisir un mot de passe personnalisÃ© (min. 8 caractÃ¨res)</li>
                    <li>Soit cliquer sur "ğŸ”„ GÃ©nÃ©rer" pour un mot de passe alÃ©atoire sÃ©curisÃ©</li>
                    <li>Soit laisser vide pour gÃ©nÃ©ration automatique cÃ´tÃ© serveur</li>
                </ul>
            </li>
            <li><strong>Confirmer la crÃ©ation</strong></li>
            <li><strong>Noter le mot de passe affichÃ©</strong> et le communiquer Ã  l'utilisateur de maniÃ¨re sÃ©curisÃ©e</li>
        </ol>
        
        <div style="background: #fef3c7; padding: 1rem; border-radius: 8px; border-left: 4px solid #f59e0b; margin-top: 1rem;">
            <p style="margin: 0; color: #92400e;">
                <strong>ğŸ’¡ Avantage :</strong> Le compte est automatiquement liÃ© Ã  l'agent, 
                permettant de crÃ©er des demandes RH et d'utiliser les workflows personnalisÃ©s.
            </p>
        </div>
        
        <h4 style="color: #4b5563; margin: 2rem 0 1rem 0;">ğŸ–Šï¸ MÃ©thode 2 : Depuis la gestion des utilisateurs</h4>
        <ol style="line-height: 1.8; color: #374151;">
            <li><strong>Aller dans "Gestion des Utilisateurs"</strong></li>
            <li><strong>Cliquer sur "â• Nouvel Utilisateur"</strong></li>
            <li><strong>Remplir le formulaire</strong> :
                <ul>
                    <li>Email (obligatoire)</li>
                    <li>Nom complet</li>
                    <li>Mot de passe</li>
                    <li>Type d'utilisateur (admin, moderator, user)</li>
                    <li>Lier Ã  un agent (optionnel mais recommandÃ©)</li>
                </ul>
            </li>
            <li><strong>Enregistrer</strong></li>
        </ol>
    </div>

    <!-- Lier un utilisateur Ã  un agent -->
    <div class="card" style="margin-bottom: 2rem;">
        <h3 style="color: #1f2937; margin-bottom: 1.5rem;">ğŸ”— Lier un Utilisateur Ã  un Agent</h3>
        
        <p style="color: #4b5563; line-height: 1.8; margin-bottom: 1rem;">
            Le lien entre un utilisateur et un agent est <strong>essentiel</strong> pour :
        </p>
        
        <ul style="color: #374151; line-height: 1.8;">
            <li>âœ… Permettre Ã  l'utilisateur de crÃ©er des demandes RH</li>
            <li>âœ… Identifier automatiquement le demandeur dans les workflows</li>
            <li>âœ… Assigner des rÃ´les personnalisÃ©s dans les circuits de validation</li>
            <li>âœ… Afficher les informations personnelles (matricule, service, grade, etc.)</li>
        </ul>
        
        <div style="background: #fee2e2; padding: 1rem; border-radius: 8px; border-left: 4px solid #dc3545; margin-top: 1rem;">
            <p style="margin: 0; color: #991b1b;">
                <strong>âš ï¸ Important :</strong> Un utilisateur non liÃ© Ã  un agent ne pourra pas crÃ©er de demandes RH 
                ni participer aux workflows de validation.
            </p>
        </div>
    </div>

    <!-- GÃ©rer les permissions -->
    <div class="card" style="margin-bottom: 2rem;">
        <h3 style="color: #1f2937; margin-bottom: 1.5rem;">ğŸ” GÃ©rer les Permissions</h3>
        
        <h4 style="color: #4b5563; margin-bottom: 1rem;">Modifier le type d'utilisateur</h4>
        <ol style="line-height: 1.8; color: #374151;">
            <li>Dans la liste des utilisateurs, cliquer sur <strong>âœï¸ Modifier</strong></li>
            <li>Changer le champ "Type d'utilisateur"</li>
            <li>Enregistrer les modifications</li>
        </ol>
        
        <h4 style="color: #4b5563; margin: 2rem 0 1rem 0;">Activer/DÃ©sactiver un compte</h4>
        <ul style="line-height: 1.8; color: #374151;">
            <li><strong>DÃ©sactiver :</strong> L'utilisateur ne pourra plus se connecter mais ses donnÃ©es sont conservÃ©es</li>
            <li><strong>RÃ©activer :</strong> L'utilisateur peut Ã  nouveau se connecter</li>
            <li><strong>Supprimer :</strong> Suppression dÃ©finitive du compte (Ã  Ã©viter)</li>
        </ul>
    </div>

    <!-- Bonnes pratiques -->
    <div class="card" style="margin-bottom: 2rem; background: #f0fdf4; border-left: 4px solid #10b981;">
        <h3 style="color: #065f46; margin-bottom: 1.5rem;">âœ¨ Bonnes Pratiques</h3>
        
        <ul style="color: #064e3b; line-height: 2;">
            <li>âœ… <strong>Toujours lier les utilisateurs aux agents</strong> pour une gestion RH complÃ¨te</li>
            <li>âœ… <strong>Utiliser des emails professionnels</strong> (prenom.nom@ministere.sn)</li>
            <li>âœ… <strong>GÃ©nÃ©rer des mots de passe forts</strong> et les communiquer de maniÃ¨re sÃ©curisÃ©e</li>
            <li>âœ… <strong>DÃ©finir le bon type d'utilisateur</strong> selon les responsabilitÃ©s</li>
            <li>âœ… <strong>DÃ©sactiver plutÃ´t que supprimer</strong> pour conserver l'historique</li>
            <li>âœ… <strong>VÃ©rifier rÃ©guliÃ¨rement</strong> les comptes inactifs</li>
        </ul>
    </div>

    <!-- DÃ©pannage -->
    <div class="card" style="background: #fef2f2; border-left: 4px solid #ef4444;">
        <h3 style="color: #991b1b; margin-bottom: 1.5rem;">ğŸ”§ DÃ©pannage</h3>
        
        <h4 style="color: #7f1d1d; margin-bottom: 0.5rem;">âŒ "Votre compte n'est pas liÃ© Ã  un agent"</h4>
        <p style="color: #991b1b; margin-bottom: 1rem;">
            <strong>Solution :</strong> Demander Ã  un administrateur de modifier votre compte utilisateur 
            et de sÃ©lectionner votre agent dans le champ "Agent associÃ©".
        </p>
        
        <h4 style="color: #7f1d1d; margin-bottom: 0.5rem;">âŒ "Email dÃ©jÃ  utilisÃ©"</h4>
        <p style="color: #991b1b; margin-bottom: 1rem;">
            <strong>Solution :</strong> VÃ©rifier si un compte existe dÃ©jÃ  avec cet email. 
            Si l'utilisateur a oubliÃ© son mot de passe, utiliser la fonction de rÃ©initialisation.
        </p>
        
        <h4 style="color: #7f1d1d; margin-bottom: 0.5rem;">âŒ "Cet agent a dÃ©jÃ  un compte utilisateur"</h4>
        <p style="color: #991b1b; margin: 0;">
            <strong>Solution :</strong> L'agent est dÃ©jÃ  liÃ© Ã  un compte. 
            VÃ©rifier dans la liste des utilisateurs pour retrouver le compte existant (icÃ´ne <code style="background: #d1fae5; padding: 0.2rem 0.5rem; border-radius: 4px; color: #10b981;">ğŸ‘¤âœ“</code> verte).
        </p>
    </div>

</div>
{% endblock %}


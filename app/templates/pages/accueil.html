{% extends "layouts/base.html" %}

{% block title %}
Accueil
{% endblock %}


{% block content %}
<style>
    .demo-notice {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
        font-weight: 500;
    }
    
    .demo-mode {
        opacity: 0.8;
        position: relative;
    }
    
    .demo-mode::after {
        content: "DEMO";
        position: absolute;
        top: 5px;
        right: 5px;
        background: #ff6b6b;
        color: white;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 10px;
        font-weight: bold;
    }
</style>
<body class="form-page-premium">
<div class="dashboard-grid">
       
    <!-- Activité récente -->
    <div class="activity-section">
        <h3>📋 Activité Récente (7 derniers jours)</h3>
        <div class="activity-list">
            {% if recent_activity %}
                {% for activity in recent_activity %}
                    <div class="activity-item">
                        <div class="activity-icon">{{ activity.icon }}</div>
                        <div class="activity-content">
                            <div class="activity-header">
                                <span class="activity-user">{{ activity.user_full_name or activity.user_email }}</span>
                                <span class="activity-badge">{{ activity.action_type }}</span>
                            </div>
                            <div class="activity-description">{{ activity.description }}</div>
                            <div class="activity-meta">
                                <span class="activity-target">🎯 {{ activity.target_type }}</span>
                                <span class="activity-time">🕐 {{ activity.time|format_datetime }}</span>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p class="empty-state">Aucune activité récente</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Modules accessibles selon les permissions -->
    {% if current_user %}
    {% if current_user.is_guest %}
    <div class="quick-actions">
        <h3>🎯 Mode Démonstration (MVP)</h3>
        <p class="demo-notice">Vous êtes en mode invité. Vous pouvez parcourir la structure mais sans accès aux données réelles.</p>
        <div class="actions-grid">
            <!-- Tous les modules visibles mais en mode démo -->
            <a href="{{ url_for('rh_home') }}" class="action-button demo-mode">
                <span class="action-icon">👥</span>
                <span class="action-text">Ressources Humaines (Démo)</span>
            </a>
            <a href="{{ url_for('budget_home') }}" class="action-button demo-mode">
                <span class="action-icon">💰</span>
                <span class="action-text">Budget (Démo)</span>
            </a>
            <a href="{{ url_for('performance_home') }}" class="action-button demo-mode">
                <span class="action-icon">📊</span>
                <span class="action-text">Performance (Démo)</span>
            </a>
            <a href="{{ url_for('stock_home') }}" class="action-button demo-mode">
                <span class="action-icon">📦</span>
                <span class="action-text">Stocks (Démo)</span>
            </a>
            <a href="{{ url_for('personnel_home') }}" class="action-button demo-mode">
                <span class="action-icon">👤</span>
                <span class="action-text">Personnel (Démo)</span>
            </a>
        </div>
    </div>
    {% else %}
    <div class="quick-actions">
        <h3>Modules disponibles</h3>
        <div class="actions-grid">
            <!-- Module RH -->
            {% if current_user.type_user == 'admin' or current_user.type_user == 'daf' or current_user.type_user == 'sdrh' or current_user.type_user == 'cs' or current_user.type_user == 'agent' %}
            <a href="{{ url_for('rh_home') }}" class="action-button">
                <span class="action-icon">👥</span>
                <span class="action-text">Ressources Humaines</span>
            </a>
            {% endif %}
            
            <!-- Module Budget -->
            {% if current_user.type_user == 'admin' or current_user.type_user == 'daf' or current_user.type_user == 'sdb' %}
            <a href="{{ url_for('budget_home') }}" class="action-button">
                <span class="action-icon">💰</span>
                <span class="action-text">Budget</span>
            </a>
            {% endif %}
            
            <!-- Module Performance -->
            {% if current_user.type_user == 'admin' or current_user.type_user == 'daf' or current_user.type_user == 'sdb' %}
            <a href="{{ url_for('performance_home') }}" class="action-button">
                <span class="action-icon">📊</span>
                <span class="action-text">Performance</span>
            </a>
            {% endif %}
            
            <!-- Module Stocks -->
            {% if current_user.type_user == 'admin' or current_user.type_user == 'daf' or current_user.type_user == 'sdc' %}
            <a href="{{ url_for('stock_home') }}" class="action-button">
                <span class="action-icon">📦</span>
                <span class="action-text">Stocks</span>
            </a>
            {% endif %}
            
            <!-- Module Personnel -->
            {% if current_user.type_user == 'admin' or current_user.type_user == 'daf' or current_user.type_user == 'sdrh' or current_user.type_user == 'cs' %}
            <a href="{{ url_for('personnel_home') }}" class="action-button">
                <span class="action-icon">👤</span>
                <span class="action-text">Personnel</span>
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <!-- Paramétrages système - Admin seulement -->
    {% if current_user.type_user == 'admin' or current_user.is_superuser %}
    <div class="quick-actions">
        <h3>Paramétrages système</h3>
        <div class="actions-grid">
            <a href="{{ url_for('gestion_utilisateurs') }}" class="action-button">
                <span class="action-icon">👥</span>
                <span class="action-text">Gérer les utilisateurs</span>
            </a>
            <a href="{{ url_for('parametres_systeme') }}" class="action-button">
                <span class="action-icon">⚙️</span>
                <span class="action-text">Paramètres</span>
            </a>
            <a href="{{ url_for('workflow_config_home') }}" class="action-button">
                <span class="action-icon">🔄</span>
                <span class="action-text">Workflows</span>
            </a>
            <a href="{{ url_for('referentiels_home') }}" class="action-button">
                <span class="action-icon">📚</span>
                <span class="action-text">Référentiels</span>
            </a>
        </div>
    </div>
    {% endif %}
    {% endif %}
</div>
</body>
{% endblock %}

